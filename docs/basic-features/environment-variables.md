---
description: Ознакомьтесь с тем, как добавлять и получать доступ к переменным среды в вашем приложении на Next.js.
---

# Переменные среды

> Эта часть документации акутальна для Next.js версий 9.4 и выше. Если вы используете более ранние версии Next.js, можете обновиться или обратиться к [переменным среды в next.config.js](/docs/api-reference/next.config.js/environment-variables.md).

<details open>
  <summary><b>Примеры</b></summary>
  <ul>
    <li><a href="https://github.com/vercel/next.js/tree/canary/examples/environment-variables">Переменные среды</a></li>
  </ul>
</details>

Next.js из коробки поддерживает переменные среды, что позволяет вам делать следующее:

- [Переменные среды](#переменные-среды)
  - [Загрузка переменных среды](#загрузка-переменных-среды)
  - [Предоставление переменных среды браузеру](#предоставление-переменных-среды-браузеру)
  - [Переменные среды по умолчанию](#переменные-среды-по-умолчанию)
  - [Переменные среды на платформе Vercel](#переменные-среды-на-платформе-vercel)
  - [Переменные среды для тестирования](#переменные-среды-для-тестирования)

## Загрузка переменных среды

Next.js имеет встроенную поддержку загрузки переменных среды из `.env.local` в `process.env`.

Пример `.env.local`:

```bash
DB_HOST=localhost
DB_USER=myuser
DB_PASS=mypassword
```

Этот код загрузит переменные `process.env.DB_HOST`, `process.env.DB_USER`, и `process.env.DB_PASS` внутрь окружения Node.js, делая их доступными внутри [методов для получения данных](/docs/basic-features/data-fetching.md) and [API routes](/docs/api-routes/introduction.md).

Пример ниже иллюстрирует использование с [`getStaticProps`](/docs/basic-features/data-fetching.md#getstaticprops-static-generation):

```js
// pages/index.js
export async function getStaticProps() {
	const db = await myDB.connect({
		host: process.env.DB_HOST,
		username: process.env.DB_USER,
		password: process.env.DB_PASS,
	});
	// ...
}
```

> **Примечание**: Чтобы сохранить серверные пароли в безопасности, Next.js заменяет `process.env.*` подходящими значениями
> во время сборки. Это обозначает, что `process.env` - не стандартный объект JavaScript, поэтому вы не можете использовать
> [деструктуризацию объектов](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment).
> Пересенные окружения должны указываться в такой нотации `process.env.NEXT_PUBLIC_PUBLISHABLE_KEY`, _но никак не в такой_ `const { NEXT_PUBLIC_PUBLISHABLE_KEY } = process.env`.

> **Примечание**: Next.js автоматически развернет переменные (`$VAR`) из ваших `.env*` файлов.
> Это позволит вам ссылаться на другие пароли, например:
>
> ```bash
> # .env
> HOSTNAME=localhost
> PORT=8080
> HOST=http://$HOSTNAME:$PORT
> ```
>
> Если в значении переменной вам понадобится использовать символ `$`, его необходимо экранировать следующим побразом: `\$`.
>
> Например:
>
> ```bash
> # .env
> A=abc
>
> # трансформируется в "preabc"
> WRONG=pre$A
>
> # трансформируется в "pre$A"
> CORRECT=pre\$A
> ```

## Предоставление переменных среды браузеру

По умолчанию, все переменные среды загружаются из `.env.local` и доступны только в окружении Node.js. Это обозначает, что они не будут отображаться в браузере.

Для того, чтобы сделать переменную доступной для браузера, вам необходимо добавить к ней префикс `NEXT_PUBLIC_`. Например:

```bash
NEXT_PUBLIC_ANALYTICS_ID=abcdefghijk
```

Этот код автоматически загрузит переменную `process.env.NEXT_PUBLIC_ANALYTICS_ID` в окружение Node.js, позволяя использовать ее в любом месте вашего кода. Ее значение будет встроено в JavaScript код, который отправляется браузеру, потому как был использован префикс `NEXT_PUBLIC_`. Это встраивание происходит в момент сборки, поэтому ваши переменные с префиксами `NEXT_PUBLIC_` должны быть доступны в момент сборки.

```js
// pages/index.js
import setupAnalyticsService from "../lib/my-analytics-service";

// переменная NEXT_PUBLIC_ANALYTICS_ID может быть использована здесь, потому как она имеет префикс NEXT_PUBLIC_
setupAnalyticsService(process.env.NEXT_PUBLIC_ANALYTICS_ID);

function HomePage() {
	return <h1>Hello World</h1>;
}

export default HomePage;
```

## Переменные среды по умолчанию

Обычно нужен только один файл `.env.local`, хотя иногда вам может понадобиться установить какие-нибудь значения по умолчанию для окружений `development` (`next dev`) или `production` (`next start`).

Next.js позволяет вам установить значения по умолчанию в `.env` (все окружения), `.env.development` (окружение для разработки), and `.env.production` (окружение для продакшна).

`.env.local` всегда переопределяет установленные по умолчанию значения.

> **Примечание**: Файлы `.env`, `.env.development`, и `.env.production` должны быть включенв в ваш репозиторий, так как они определяют значения по умолчанию. **Файлы же `.env*.local` должны быть добавлены в `.gitignore`**, как файлы, которые следует игнорировать. Файл `.env.local` является местом для хранения паролей.

## Переменные среды на платформе Vercel

Когда вы разворачиваете свое приложение на Next.js с помощью платформы [Vercel](https://vercel.com), переменные среды должны быть сконфигурированы [в настройках проекта](https://vercel.com/docs/environment-variables).

Все типы переменных окружения должны быть сконфигурированы там. Даже переменные среды для разработки, которые можно [загрузить на ваше локальное устройство](https://vercel.com/docs/environment-variables#development-environment-variables) впоследствии.

Если вы настроили [переменные среды для разработки](https://vercel.com/docs/environment-variables#development-environment-variables), можете поместить их в файл `.env.local` для использования на вашей локальной машине с помощью команды:

```bash
vercel env pull .env.local
```

При использовании Vercel CLI для деплоя, убедитесь, что вы добавили файл [`.vercelignore`](https://vercel.com/guides/prevent-uploading-sourcepaths-with-vercelignore?query=vercelignore#allowlist), который включает список файлов, которые не должны быть загружены. Обычно это те же файлы, что добавляются в `.gitignore`.

## Переменные среды для тестирования

Помимо переменных среды для разработки (`development`) и продкшна (`production`), доступна еще и третья опция: `test`. Точно также, как вы устанавливаете значения для разработки и продакшна, вы можете установить переменные для тестирования в файле `.env.test` (хотя этот кейс не так распространен, как два предыдущих).

Использование файла `.env.test` удобно при запуске тестов вроде `jest` или `cypress`, где вам необходимо определить переменные среды исключительно для тестирования. Значения для тестирования будут загружены в случае, если
переменная `NODE_ENV` установлена в значении `test`, хотя обычно вам не придется делать это вручную, потому как инструменты тестирования обычно делают это автоматически.

Существует небольшая разница между переменными среды для `test` и для `development` с `production` и о ней нужно помнить: `.env.local` не будет загружен, поскольку вы ожидаете, что тесты будут давать одинаковые результаты для всех. Таким образом, каждое выполнение тестов будет давать одинаковый результат, игнорируя ваш файл `.env.local` (который обычно переназначает переменные по умолчанию).

> **Примечание**: аналогично с переменными среды по умолчанию, файл `.env.test` должен быть добавлен в репозиторий, однако файл `.env.test.local` не должен, все файлы с паттерном `.env*.local` должны быть добавлены в `.gitignore`.

С помощью функции `loadEnvConfig` из пакета `@next/env` вы можете убедиться, что при выполнении unit-тестов переменные загружаются таким же способом, как и в Next.js.

```js
// Приведенный ниже файл можно использовать в глобальном файле настроек тестирования, например, в Jest (или аналогичной библиотеке).
import { loadEnvConfig } from "@next/env";

export default async () => {
	const projectDir = process.cwd();
	loadEnvConfig(projectDir);
};
```
